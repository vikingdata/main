<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head>
    <!--#include virtual="/include/header.html" -->
    
    <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type"><title>SQL: MySQL commit</title>
    
  </head>
  <body>

    <!--#include virtual="/include/body_header.html" -->
    
    
    <h1><a class="mozTocH1" name="mozTocId909994"></a>SQL: MySQL commit</h1>
The purpose of this document is to show to commit data (schema or data) in  production
environment for one MySQL server. Each company has its own prodcedure. We will cover
generic procedures. 
<hr>
<ol>
  <li><a href="#mozTocId514232">No Links</a></li>
  <li><a href="#general">General Procedure</a></li>
  <li><a href="#setup">The MySQL setup. </a></li>
  <li><a href="#techniques">Commit Techniques </a></li>
  <li><a href="#steps">The steps</a></li>

</ol>

<h2><a class="mozTocH2" name="mozTocId514232"></a>No Links</h2>
No links, this article is stuff I have used in production before. 

<br><hr style="width: 100%; height: 2px;">
<h2><a class="mozTocH2" name="general">General steps. </a></h2>
These are high level steps. We aren't going to go into details with each one. 

<ol>
  <li>https://docs.ansible.com/ansible/latest/dev_guide/overview_architecture.html
</ol>

<h3>Setup</h3>
<pre>
  create database
  create table
  insert data

  create table
  insert data
</pre>

<br><hr style="width: 100%; height: 2px;">
<h2><a class="mozTocH2" name="techniques">Commit techniques</a></h2>
<h3> Source sql file</h3>
You can do it one of two ways:
<ul>
  <li>In the mysql prompt "source FILE.sql" will execute commands in the file and keep going even if there are errors.
  <li> Or "cat FILE.sql | mysql" with mysql options will submit commands to mysql. It should stop on the first error.
</ul>

You must be careful with either solutions. Lets assume all the commands work.
Should log all commands. In general
<uL>
  <li> mysql should be executed as "mysql -v -v -v"
  <li> The first commands should be <pre>
      tee error.log
      use database DB;
      select now(), @@hostname, USER();
      begin;

      # Your commands, not schema changes.

      commit;
    </pre>
    <li>Analyze the error log with "grep -i err error.log" and look for any errors. NOTE: you may get false errors. 
    <li> Feel free is to discuss your own requirements. 
</ul>

Doing it this is either way you need to be careful of:
<ol>
  <li>Any schema changes. They can commit changes and also cuase locks. 
  <li>Data or schema changes may lock queries.
  <li>Data or schema changes can use of diskspace.
  <li> It might be wise to break up sql files to commit to data and schema separetly and
    to do a different sql file for each ticket. 
</ol>

<h4>Online DDL Operations</h4>
<ul>
  <li><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-online-ddl-operations.html">Online DDL Operations</a>
</ul>

Some schema changes can be made without locking, without creating a new table, and does not block queries.
Different versions of MySQL allow different DDL operations without hassle.
However, the operations my slow down the system. Online DDL Operations is used a lot
and very benefincial and can be combined with the sql change files.

<h4> Percona online schema changes</h4>
<ul>
  <li><a href="https://www.percona.com/doc/percona-toolkit/3.0/pt-online-schema-change.html">pt-online-schema-change</a>
Percona online schema change creates a temporary new table, populates the new table, use triggers to make the new identical the same as the old with the changes, and then
swaps the tables, and usually deletes the now old table.
    <p>
      This technique can be used for almost all schama changes. There are some
      exceptions, like if triggers exist. Also, some versions make only work with some
      versions of MySQL. 
    <p>
      This is used a lot and be used with sql change files.

<br><hr style="width: 100%; height: 2px;">
<h2><a class="mozTocH2" name="sample"></a>Sample Steps</h2>


<br><hr style="width: 100%; height: 2px;">
<h2><a class="mozTocH2" name="other"></a>Other things with ansible</h2>



<hr style="width: 100%; height: 2px;">
<!--#include virtual="/include/body_footer.html" -->

</body></html>
